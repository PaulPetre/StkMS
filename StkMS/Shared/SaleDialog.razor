@using StkMS.ViewModels
@using StkMS.Contracts
@using System.Globalization;

@inject IReportGenerator reportGenerator
@inject IJSRuntime jsRuntime

<MudDialog>
    <DialogContent>
        <MudText>Bon Nr. @sale.Id din @sale.DateTime.ToString("U")</MudText>
        <MudTable Items="@sale.Items" Hover="true" Breakpoint="Breakpoint.Sm">
            <HeaderContent>
                <MudTh>Cod Produs</MudTh>
                <MudTh>Nume</MudTh>
                <MudTh>U.M</MudTh>
                <MudTh>Preț</MudTh>
                <MudTh>Cantitate</MudTh>
                <MudTh>Valoare</MudTh>

            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Cod Produs">@context.Code</MudTd>
                <MudTd DataLabel="Nume">@context.Name</MudTd>
                <MudTd DataLabel="U.M">@context.Unit</MudTd>
                <MudTd DataLabel="Preț">@context.UnitPrice.ToString("F2")</MudTd>
                <MudTd DataLabel="Cantitate">@context.Quantity.ToString("F2")</MudTd>
                <MudTd DataLabel="Valoare">@context.Value.ToString("F2")</MudTd>
            </RowTemplate>
        </MudTable>
        <MudPaper Class="d-flex flex-row-reverse py-2 px-1" >
            <MudText > Total Valoare @sale.TotalValue</MudText>
        </MudPaper>
    </DialogContent>
    <DialogActions>
        <MudButton Color="Color.Secondary" OnClick="GenerateInventoryAsync">Print</MudButton>
        <MudButton Color="Color.Primary" OnClick="Cancel">Ok</MudButton>
    </DialogActions>
</MudDialog>
@code
{ [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    [Parameter]
    public SaleDetailsViewModel sale { get; set; }


    void Cancel() => MudDialog.Cancel();

    private async void GenerateInventoryAsync()
    {
        var bytes = reportGenerator.GenerateSaleReport(sale);
        await jsRuntime.InvokeVoidAsync("BlazorDownloadFile", $"sale{sale.Id}.pdf", "application/octet-stream", bytes).ConfigureAwait(true);
    } }
